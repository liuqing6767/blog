<!--
author: 刘青
date: 2016-07-27
-->

HTTP/1.1 由三个RFC定义：


本文概要的描述 HTTP/1.1 的：
- 消息语法
- 消息转换
- 连接管理
- 相关的安全概念




---------------
> Q： HTTP是什么？

超文本传输协议（Hypertext Transfer Protocol），世界上所有的浏览器、服务器和相关的web应用都通过其进行交流，HTTP是当代互联网的公共语言，web的基础。

---------------
> Q： HTTP可靠么？

数以万计的图片，HTML文件，文本或者电影以及音频都通过HTTP从服务器传输到用户的浏览器，HTTP是一个可靠的数据传输协议，它保证你的数据在传输过程中不会被损坏。

---------------
> Q： web客户端和服务器是什么？

Web服务器因为使用HTTP协议，所以常常被称作HTTP服务器，保存互联网数据已经对HTTP客户端的请求进行响应。
Web客户端我们日常最常用的就是浏览器。浏览器请求HTTP对象并进行呈现。
当我们浏览一个网页时，浏览器先发送一个HTTP请求给服务器，服务器对请求进行响应，包括响应对象的类型、长度和其他信息。

---------------
> Q： 资源指的是什么？

资源是一切内容的基础。web服务器组织web资源。web资源是web内容的基础。
资源能是静态的，比如文件系统上的一个文件；
资源能是动态的，可能由软件程序动态的生成。

---------------
> Q： 媒体类型是什么？

互联网中有成千上万种数据类型，HTTP对每种数据将被传输的类型都使用`MIME type`进行标注。
MIME（Multipurpose Internet Mail Extensions）（多用途互联网邮件扩展）最初是为了解决不同电子邮件系统之间移动信息是出现的问题的。它在邮件系统中的良好表现以至于HTTP将其进行改变来描述自己的多媒体内容。
Web服务器将一个MIME 类型附加到所有的HTTP对象数据中。当浏览器得到其数据以后就可以根据关联的MIME进行处理。
MIME类型以字符串形式呈现，形式为 主类型/子类型，如：text/html， image/jpeg，application/vnd.ms-powerpoint。

---------------
> Q： 资源如何定位

每个服务器资源都有一个名字，这样客户端可以去获取它感兴趣的资源，这个名字叫做 `URIs` (uniform resource identifier)。URIs现在有两种形式： URLs 和 URNs。

`URLs`（uniform resource locator）是最通用的资源定位形式。
对于 http://www.baidu.com/a.c.gif ，它的组成是：

| 项目 |  协议 | 主机位置  | 资源路径 |
| --- | ------| ---- | ---|
| 示例 |   http:// |  www.baidu.com  | /a/c.gif |

`URNs`(uniform resource name) 还是只存在实验室。它想让每个资源有一个唯一的名称，有一台服务器可以对名称和资源进行解析，这样，资源的更换对获取者来说就是透明的。

---------------
> Q： 一次HTTP具体的流程是什么？

一个HTTP的具体流程包括一个请求命令和一个响应结果，通过 `HTTP messages`来传输被格式化的了的数据。

HTTP支持多种请求命令，叫 `HTTP methods`。每个HTTP 请求信息都有一个方法，告诉服务器如何处理请求。
一些常用的 HTTP methods：

| HTTP方法   | 说明 | 
| ------ | -----| 
| GET    | 从服务器发送一个已命名资源给客户端 |
| PUT    | 将客户端的数据存储到服务器已命名资源中 |
| DELETE | 从服务器上删除已命名资源 |
| POST   | 将客户端数据发送到服务器网关应用 |
| HEAD   | 仅返回一个已命名资源的 HTTP head |

每个响应消息都会有一个三位数的状态码，客户端可以自动请求是否成功，或者有其他的行为被要求。

一个应用常常是有多个请求组合而成的。比如浏览器，其实会处理一系列的HTTP事务来获取和展现一个页面。

---------------
> Q： HTTP消息的结构是什么样的？

HTTP消息一共有两类：
- 从客户端发出来的是 请求消息；
- 从服务端发出来的是 响应消息。

HTTP消息的结构是面对行数据的。文本形式，人眼可读，比较简单，包括：

| 消息组成  |  请求消息示例 | 响应消息示例 | 说明 |
| ---| ----- | ---| ---|
|Start line（第一行）| GET /test/a.html HTTP/1.0 |HTTP/1.0 200 OK | 表明请求或响应发生了什么
|Header fields（头部字段）| Accept:text/* <br> Accept-Language: en,for |Content-type: text/plain<br> Content-length: 19 | 每个头字段为 key:value，最后一定加一个空行 |
|Body（消息体）|  | Hi I'm a message ! | 空行后面是可选的消息体，可以包含任何类型的数据发生给服务器或者响应给客户端，可以是非文本 |

---------------
> Q： HTTP消息是如何进行数据传输的？

HTTP使用TCP(Transmission Control Protocol)连接进行数据的传递。HTTP是应用层的协议，不考虑网络的具体细节。

HTTP客户端和服务器之间要先使用 Internet protocol(IP)地址和端口号建立联系才能使用 TCP/IP来通信。客户端通过URLs来获取IP和端口号，大致过程为：
1. 浏览器从URL中解析出服务器的主机名；
2. 浏览器将主机名转换为IP地址；
3. 浏览器从URL中解析出端口号；
4. 浏览器和服务器之间建立 TCP 连接；
5. 浏览器发送 HTTP请求消息 给服务器；
6. 服务器发送 HTTP响应消息 给浏览器；
7. 连接关闭，浏览器展示数据。

---------------
> Q： HTTP协议有哪些版本呢？

今天我们使用的HTTP协议确实有几个版本，HTTP应用需要对这些版本进行兼容处理，大概有：

| 版本    | 时间 | 说明 | 
| --- | --- | ---|
|  HTTP/0.9  | 1991 | 设计上有重大缺陷，不宜使用 |
|  HTTP/1.0  |  | 第一个被广泛部署的HTTP协议。是学术和商业的最佳实践的结晶。|
|  HTTP/1.0+ | 1995± | 被添加了许多非官方的、事实上的标准，比如：超链接、代理连接  |
|  HTTP/1.1  |  | 修正架构缺陷，提高性能，移除错误的特性 |
|  HTTP-NG HTTP/2.0  | 1998 | 提高性能，但是没有打算作为替代版本进行提出 |

---------------
> Q： Web 有哪些架构组件？

| 组件 | 说明 |
| --- | ----|
| 代理 Proxies  | 客户端和服务器端之间的媒介。代理接收客户端请求再发给服务器，再将响应返回给客户端。代理常常用来处理安全问题，应用集成和性能调优，也可以用来过滤请求和响应。  |
| 缓存 Caches | web cache 或者 caching proxy 是一种特别的HTTP代理。它对流行的文件在通过代理时保存副本，这样客户端就可以就近快速的下载文件副本。 |
| 网关 Gateways | 网关常常在不同的服务组件充当媒介，将HTTP转换为其他的协议，比如：HTTP/FTP网关收到一个FTP的URIs的HTTP请求，它使用FTP协议将资源拿到再返回给客户端。网关也常常作为资源的源服务器。 |
|隧道 Tunnels| 隧道保证将数据的传输是透明的，HTTP隧道常常被永安里传输非HTTP数据。一个流行的用法是通过HTTP连接传输加密的 Secure Sockets Layer（SSL）。|
| 客户端 Agents | 处理web请求的都是HTTP代理，它能够根据用户的行为发送HTTP请求。最常见的代理就是浏览器。其他的例子是"spiders"或"web robots"自动得获取数据。 |



---------------
> Q：URLs和资源有什么关系？

前面我们简要的说明了URL是什么，它指明资源的所在地以及与其交互的方式。举一个现实世界的列子：你要来我家，我会告诉你地址。这个地址就是URL（统一资源定位符），有了它你就可以找到我家了。

---------------
> Q：URL语法是什么？

URL是有一个通用的语法的，它包括9部分：

| 组成部分|  描述  | 默认值| 示例值 |
| ------ | ------| ---- | ---- |
|scheme 机制  | 使用的访问数据库的协议 | None | http |
|user 用户    | 一些机制要求有用户名 |anonymous |  |
|password 密码| 一些机制要求有密码，在用户名后面，用 `:` 分隔 | | |
|host 主机  	 | 拥有资源的主机的主机名或IP	|  | www.baidu.com |
|port 端口  	 | 服务器监听的端口号 | 不同的机制不同 | 80 |
|path 路径    | 资源在服务器上本地路径 | None | /a/b.html |
|params 参数  | 指定入参，为键值对，用`;`和URL其他部分分隔 | | |
|query 查询参数| 指定参数，为键值对，用`?`和URL其他部分分隔 | | c=12&d=22 |
|fragment 片段  | `#`后面的内容，不会被传递到服务器，仅供客户端使用 | | ddd |

承上，我们有一个URL为： http://www.baidu.com:80/a/b.html?c=12&d=22#ddd

---------------
> Q：URL简写是什么东东？

URL其实分两类：绝对URL，相对URL。前面将的就是绝对URL语法。URL简写指的是相对URL，它是绝对URL的一部分，对它需要先转换为绝对URL在进行资源定位。

举个例子：在 http://www.baidu.com/c/b.html中有一个超链接为 `<a href="./c.html"/> `，它的绝对URL是：http://www.baidu.com/c/c.html。

上述的列子涉及到 基本URLs （Base URLs） 的概念，也就是相对URL所相对的URL：
- 要是指定了基本URL，就是它。比如 html有 `<BASE>` 标签进行指定；
- 外部资源的基本URLs。要是上面的没有指定，会使用外部文档的基本URL；
- 没有基本URL。要么是绝对URL，要么出错了。

相对URL使用前需要转换为绝对URL，将9部分补全，然后进行资源定位。

---------------
> Q：URL我经常看到中文是乱码的，这个是怎么回事？

- URLs当初的进行轻便设计，希望可以通过多种协议进行数据传输，这意味着能被接受的只有那些公共（US-ASCII）的字符集；
- 另外一方面，URL的设计为可读，意味着一下不可见字符被排除在外；
- 还有一下关键字，比如? ，它有特定的含义。

前面这些原因导致一些字符，比如中文，是不可能通过URL进行传输的。针对这个硬伤提出了编码机制：将其他字符进行转义，让其转变为可传输的字符，服务器得到后再转回去。
中文被转成“乱码”就是这个原因。

---------------
> Q：URL的机制有哪些呢？

最常见的当然是我们天天看到的http，还有：https, moilto, ftp 等等。它们都是和特定的协议挂钩的。

---------------
> Q：URL感觉很完美的样子，真的是这样么？它有什么缺陷呢，有改进措施么？

URL就是资源的位置，它有一个致命的缺陷：将资源和位置进行了绑定。当资源移动了，我们就不能通过URL找到资源了，然而资源实际上是还存在的。

针对这个缺陷，URN（uniform resource name）被提出来了。它的原理是：每个资源有特定的名称，我们根据这个名称找到正在的资源，资源的移动是透明的。但是，兼容性啊，基础建设等原因，这个还只在实验室存在。


---------------
> Q：HTTP是互联网的邮差，那他的用来装消息的包裹是什么呢？

这个比喻真的非常好，HTTP确实是互联网的邮差，他的包裹就是HTTP 消息（HTTP Messages）。HTTP Method 是在不同的HTTP 应用之间传递的消息块。里面有几个术语，稍微了解一下：
- 入站（inbound）：请求消息进入目标服务器；
- 出站（outbound）：响应消息从目标服务器返回客户端；
-  上游（upstream）：发送者一定是上游；
-  下游（downstream）：接收者一定是下游；

---------------
> Q：可以大致的讲一讲 `消息` 的构成么？

HTTP消息是一系列简单、格式良好的数据块，由三部分组成：
- 用来描述消息的首行；
- 包含一系列属性的头集合；
- 可选的数据体

无论是请求数据还是响应数据都是类似的组成结构。

```
	//请求信息
    <method> <request-URL> <version>
    <headers>
    <entity-body>

	//响应信息
	<version> <status> <reason-phrase>
    <headers>
    <entity-body>
```

|  属性  |  含义  | 举例 |
| ------- | ------| ------|
|  method | 客户端希望服务器端对资源执行的行为 | GET POST HEAD |
|  request-URL | 请求资源的 URL | |
|  version | 消息使用的HTTP版本 | HTTP/major.minor |
|  status-code | 描述请求发送了什么的三位数字  | 200 |
|  reason-phrase | 状态码的解释文本 | |
|  headers | 请求的描述信息，用 `:`分隔的键对值 | |
|  entity-body | 信息携带的具体的数据 | |


---------------
> Q：请求消息的方法具体有哪些啊？

| 方法   |    描述 |   需要消息体 |
| ------ | ------| ----- |
| GET | 从服务器获取文档 | N |
| HEAD | 只从服务器获取该消息的头 | N |
| POST | 发送数据到服务器 | Y |
| PUT | 存储请求体到服务器 | Y |
| TRACE | 跟踪消息从代理到服务器的过程 | N |
| OPTIONS | 确定在服务器上可以执行什么 | N |
| DELETE | 从服务器删除文档 | N |

对于HEAD进行补充：和GET十分相似，但是没有消息体返回，它允许客户端在没有消息体返回的情况下检查消息体的头。通常用来：
- 看看服务器有没有这个资源；
- 要是有，看看它的响应消息的状态码；
- 看看这个文件是不是改变了

对于TRACE进行补充：一个请求最终达到服务器前，它可能要经过防火墙、代理、网关以及其他的应用，每个都可能修改请求，TRACE 方法就运行客户端查看请求最终到达服务器的模样。

对于OPTIONS进行补充：它会询问服务器对普通资源或特定资源支持哪些方法，这样，客户端就可以决定访问资源的最佳途径。

并不是所有的服务器都实现了所有的方法。未来，有的服务器也可能实现他们自己的方法。

---------------
> Q：状态码又有哪些呢？含义是什么？

|    全范围 |   被使用范围 | 类型 | 解释 |
| ------ | ------| ----- | ----- |
| 100-199 |100-101 | 消息 | |
| 200-299 |200-206 | 成功 | |
| 300-399 |300-305 | 重定向 | 为请求的资源返回另外一个地址 |
| 400-499 |400-415 | 客户端错误 |
| 500-599 |500-505 | 服务器错误 |

有点枯燥，但是我们还是想了解更详细的了解状态码，下面还有一个表格：

**100 - 199：消息类状态码**  

|    状态码 |  文本说明 | 含义 |
| ------ | ------| ----- |
| 100 |Continue | 请求的初始化部分服务器端收到，客户端应该继续发送请求 |
| 101 |Switching protocols | 服务器正在将请求协议修改为客户端指定的那个 |

**200 - 299：成功状态码** 

|    状态码 |  文本说明 | 含义 |
| ------ | ------| ----- |
| 200 |Ok | 请求成功，请求的资源在返回消息体中 |
| 201 |Created | 要求保存的信息已成功保存 |
| 202 |Accepted | 服务器接收请求成功，但是并没有执行任何操作，不保证会以后会做什么操作 |
| 203 |Non-Authoritative Information | 非源服务器返回请求的内容的副本 |
| 204 |No Content | 响应内容包括首行和头，但没有消息体 |
| 205 |Reset Content | 告诉浏览器清楚当前页面的所有HTML元素 |
| 206 |Partial Content | 部分信息被返回，客户端可以继续请求 |

**300 - 399：重定向状态码** 
|    状态码 |  文本说明 | 含义 |
| ------ | ------| ----- |
| 300 |Multiple Choices | 告诉客户端请求的URL有多个资源，返回可选项列表 |
| 301 |Moved Permanently |  |
| 302 |Found | 资源被移动到其他地方，返回新的URL |
| 303 |See Other | 告诉客户端资源应该用另外一个URL |
| 304 |Not Modified | 不包含内容体，告诉客户端资源没有改变 |
| 305 |User Proxy |  |
| 306 |continue |  |
| 307 |continue |  |

**400 - 499** 
|    状态码 |  文本说明 | 含义 |
| ------ | ------| ----- |
| 400 | Bad Request | 请求的格式有误 |
| 401 | Unauthorized |  |
| 402 | Payment Required |  |
| 403 | Forbidden |  |
| 404 | Not Found |  |
| 405 | Method Not Allowed |  |
| 406 | Not Acceptable |  |
| 407 | Proxy Authentication Required |  |
| 408 | Request Timeout |  |
| 409 | Conflict |  |
| 410 | Gone |  |
| 411 | Length Required |  |
| 412 | Precondition Failed |  |
| 413 | Request Entity Too Large |  |
| 414 | Request URI Too Long |  |
| 415 | Unsupported Media Type |  |
| 416 | Requested Range Not Satisfiable |  |
| 417 | Expectation Failed |  |

**200 - 299** 
|    状态码 |  文本说明 | 含义 |
| ------ | ------| ----- |
| 500 |Internal Server Error | 处理请求时服务器内部发生错误 |
| 501 |Not Implemented | 客户端使用了服务器端不支持的方法 |
| 502 |Bad Gateway |  |
| 503 |Service Unavailable | 服务器当前不能处理这个请求，但是以后可能可以 |
| 504 |Gateway Timeout |  |
| 505 |Http Version Not Supported |  |


---------------
> Q：消息的头有哪些呢？

我们可以对头进行分类：
- 通用头：请求消息和响应消息都可以使用；
- 请求头
- 响应头
- 消息体头：描述消息体的大小和内容
- 额外头：新的头，未在说明文档中



---------------
> Q：





#HTTP的架构


#验证，授权和安全


#实体，加密和国际化


#内容的发表和分发
